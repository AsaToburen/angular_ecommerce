"use strict";angular.module("storeApp",["ngRoute","ngAnimate","storeApp.moltin","firebase"]).run(["$rootScope","$location",function(t,e){t.$on("$routeChangeError",function(t,r,n,o){"AUTH_REQUIRED"===o&&e.path("/login")})}]).constant("FIREBASE_URL","https://shopangular.firebaseio.com/"),angular.module("storeApp").config(["$routeProvider",function(t){t.when("/",{templateUrl:"views/home.html",controller:"DepartmentCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"AuthCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"AuthCtrl"}).when("/products",{templateUrl:"views/store.html",controller:"DepartmentCtrl"}).when("/products/:id",{templateUrl:"views/store.html",controller:"DepartmentCtrl"}).when("/checkout",{templateUrl:"views/checkout.html",controller:"checkoutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("storeApp").factory("Authentication",["$firebase","$location","$firebaseAuth","FIREBASE_URL",function(t,e,r,n){var o=new Firebase(n),i=r(o),c={auth:r(o),authData:{},userData:{},login:function(t){i.$authWithPassword({email:t.email,password:t.password}).then(function(t){console.log("Authenticated successfully with payload:",t)})},logout:function(){i.$unauth(),e.path("/login")},register:function(t){return i.$createUser({email:t.email,password:t.password}).then(function(e){var r=new Firebase(n+"users/"+e.uid);r.set({date:Firebase.ServerValue.TIMESTAMP,regUser:e.uid,firstname:t.firstname,lastname:t.lastname,email:t.email},function(t){t?console.log("Error:",t):console.log("Profile set successfully!")})})}};return c}]),angular.module("storeApp").factory("cartService",["$q","$location","MoltinAuth",function(t,e,r){var n={loading:!1,itemList:function(){n.loading=!0;var e=t.defer();return t.when(r).then(function(t){t.Cart.Contents(function(t){e.resolve(t),n.loading=!1})}),e.promise},addItem:function(e){var n=t.defer();return t.when(r).then(function(t){t.Cart.Insert(e,1,null,function(t){n.resolve(t)})}),n.promise},contentLoaded:!0,checkout:function(){n.contentLoaded=!1;var e=t.defer();return t.when(r).then(function(t){t.Cart.Checkout(function(t){e.resolve(t),n.contentLoaded=!0})}),e.promise},toProducts:function(){e.path("/products")}};return n}]),angular.module("storeApp").factory("deptService",["$q","MoltinAuth",function(t,e){var r={loading:!1,deptList:function(){r.loading=!0;var n=t.defer();return t.when(e).then(function(t){t.Category.List(null,function(t){n.resolve(t),r.loading=!1})}),n.promise}};return r}]),angular.module("storeApp.moltin",[]).factory("MoltinAuth",["$q",function(t){var e=t.defer(),r=new Moltin({publicId:"Z25m8FxwKcw0cAlPQuD9hOrFZquaV0rpv5shgFJS"});return r.Authenticate(function(){e.resolve(r),console.log(r)}),e.promise}]),angular.module("storeApp").factory("productService",["$q","$route","MoltinAuth",function(t,e,r){var n={loadingList:!1,loadingCategory:!0,getList:function(){n.loadingList=!0;var e=t.defer();return t.when(r).then(function(t){t.Product.List(null,function(t){e.resolve(t),n.loadingList=!1})}),e.promise},getCategory:function(){n.loadingCategory=!0;var o=t.defer();return t.when(r).then(function(t){t.Product.Search({category:e.current.params.id},function(t){o.resolve(t),n.loadingCategory=!1})}),o.promise}};return n}]),angular.module("storeApp").directive("checkout",function(){return{restrict:"E",templateUrl:"directives/checkoutBox.html",replace:!0,scope:!0}}),angular.module("storeApp").directive("departmentNav",function(){return{restrict:"E",templateUrl:"directives/department-nav.html",replace:!0,scope:!0,controller:function(t,e){t.isActive=function(t){var r=t===e.path();return r}}}}),angular.module("storeApp").directive("navigation",function(){return{restrict:"A",templateUrl:"directives/nav.html",replace:!0,scope:!0,controller:["$scope","Authentication",function(t,e){t.auth=e.auth,t.logout=e.logout}]}}),angular.module("storeApp").directive("products",function(){return{restrict:"E",templateUrl:"directives/product-section.html",replace:!0,scope:!0}}),angular.module("storeApp").directive("register",function(){return{restrict:"E",templateUrl:"directives/register.html",replace:!0,scope:!0}}),angular.module("storeApp").directive("shoppingCart",function(){return{restrict:"E",templateUrl:"directives/shopping-cart.html",replace:!0,scope:!0}}),angular.module("storeApp").controller("AuthCtrl",["$scope","$location","Authentication",function(t,e,r){t.login=function(){r.login(t.user),e.path("/products")},t.register=function(){r.register(t.user).then(function(){r.login(t.user),e.path("/products")})["catch"](function(e){t.message=e.message})},t.toRegister=function(){e.path("/register")},t.toLogin=function(){e.path("/login")},t.toProducts=function(){e.path("/products")}}]),angular.module("storeApp").controller("checkoutCtrl",["$scope","Authentication","cartService",function(t,e,r){t.auth=e,t.checkout=r,r.checkout().then(function(e){t.items=e.cart.contents,t.totals=e.cart.totals.pre_discount.rounded})}]),angular.module("storeApp").controller("DepartmentCtrl",["$scope","productService","Authentication","deptService","cartService",function(t,e,r,n,o){t.auth=r,t.departments=[],t.products=[],t.items=[],t.firstname=r.userData.firstname,t.cart=o,t.dept=n,n.deptList().then(function(e){t.departments=e}),e.getList().then(function(e){t.products=e}),e.getCategory().then(function(e){t.products=e}),o.itemList().then(function(e){t.items=e})}]);