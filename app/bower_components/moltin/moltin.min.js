/*! moltin-sdk minified - v0.6.0 - 2015-02-15 */

var Moltin,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Moltin=function(){"use strict";function a(a){this.options=this.Merge(this.options,a),this.Storage=new o,this.Address=new b(this),this.Brand=new c(this),this.Cart=new d(this),this.Category=new e(this),this.Checkout=new f(this),this.Collection=new g(this),this.Currency=new h(this),this.Entry=new j(this),this.Gateway=new k(this),this.Order=new l(this),this.Product=new m(this),this.Shipping=new n(this),this.Tax=new p(this),this.Storage.get("_mc")&&(this.options.currency=this.Storage.get("_mc")),this.Storage.get("_ms")||this.Storage.set("_ms",this.Cart.CreateIdentifier())}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return a.prototype.options={publicId:"",auth:{},url:"https://api.molt.in/",version:"beta",debug:!1,currency:!1,notice:function(a,b){return alert(a+": "+b)},methods:["GET","POST","PUT","DELETE"]},a.prototype.Merge=function(a,b){var c,d,e;d={};for(c in a)e=a[c],d[c]=e;for(c in b)e=b[c],d[c]=e;return d},a.prototype.InArray=function(a,b){return __indexOf.call(b,a)<0?!1:!0},a.prototype.Serialize=function(a,b){var c,d,e;null==b&&(b=null),d=[];for(c in a)e=a[c],c=null!==b?b+"["+c+"]":c,d.push("object"==typeof e?this.Serialize(e,c):encodeURIComponent(c)+"="+encodeURIComponent(e));return d.join("&")},a.prototype.Error=function(a){var b,c,d,e;if(c="","undefind"!=typeof a.errors){e=a.errors;for(b in e)d=e[b],c+=d+"<br />"}else c=a.error;return this.options.notice("Error",c)},a.prototype.Ajax=function(a){var b,c,d,e,f,g,h;b={type:"GET",async:!1,data:null,timeout:5e3,headers:{},url:this.options.url+this.options.version,success:function(){},error:function(){}},b=this.Merge(b,a),b.type=b.type.toUpperCase();try{e=new XMLHttpRequest}catch(i){c=i;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){return c=i,!1}}"GET"===b.type?(b.url+="?"+this.Serialize(b.data),b.data=null):b.data=this.Serialize(b.data),e.open(b.type,b.url,b.async),f=setTimeout(function(a){return function(){return e.abort(),b.error(a.options.notice("error","Your request timed out"))}}(this),b.timeout),h=b.headers;for(d in h)g=h[d],e.setRequestHeader(d,g);return e.onreadystatechange=function(){var a;return 4!==e.readyState?null:(clearTimeout(f),a=JSON.parse(e.responseText),"2"!==e.status.toString().charAt(0)?b.error(e,e.status,a):b.success(a,e.status,e))},e.send(b.data)},a.prototype.Authenticate=function(a){var b;return this.options.publicId.length<=0?this.options.notice("error","Public ID must be set"):null!==this.Storage.get("_mt")&&parseInt(this.Storage.get("_me"))>Date.now()?(this.options.auth={token:this.Storage.get("_mt"),expires:this.Storage.get("_me")},"function"==typeof a&&a(this.options.auth),b=new CustomEvent("MoltinReady",{detail:this}),window.dispatchEvent(b),this):(this.Ajax({type:"POST",url:this.options.url+"oauth/access_token",data:{grant_type:"implicit",client_id:this.options.publicId},async:"function"==typeof a?!0:!1,headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(c){return function(d){return c.options.auth={token:d.access_token,expires:1e3*parseInt(d.expires)},c.Storage.set("_mt",d.access_token),c.Storage.set("_me",c.options.auth.expires),"function"==typeof a&&a(d),b=new CustomEvent("MoltinReady",{detail:c}),window.dispatchEvent(b)}}(this),error:function(a){return function(){return a.options.notice("error","Authorization failed")}}(this)}),this)},a.prototype.Request=function(a,b,c,d){var e,f;return null==b&&(b="GET"),null==c&&(c=null),e={},f={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer "+this.options.auth.token,"X-Session":this.Storage.get("_ms"),"X-Location":window.location.href},null===this.options.auth.token?this.options.notice("error","You must authenticate first"):(Date.now()>parseInt(this.Storage.get("_me"))&&this.Authenticate(),this.InArray(b,this.options.methods)?(this.options.currency&&(f["X-Currency"]=this.options.currency),this.Ajax({type:b,url:this.options.url+this.options.version+"/"+a,data:c,async:"function"==typeof d?!0:!1,headers:f,success:function(){return function(a){return"function"==typeof d?d(a.result,"undefined"!=typeof a.pagination?a.pagination:null):e=a}}(this),error:function(a){return function(b,c){var d;return d=JSON.parse(b.responseText),d.status===!1&&a.options.notice("error","undefined"!=typeof d.errors?d.errors:d.error,c),e=d}}(this)}),"undefined"==typeof d?e.result:void 0):this.options.notice("error","Invalid request method ("+b+")"))},o=function(){function a(){}return a.prototype.set=function(a,b,c){var d,e;return e="",c&&(d=new Date,d.setTime(d.getTime()+24*c*60*60*1e3),e="; expires="+d.toGMTString()),document.cookie=a+"="+b+e+"; path=/"},a.prototype.get=function(a){var b,c,d,e;for(a+="=",e=document.cookie.split(";"),c=0,d=e.length;d>c;c++){for(b=e[c];" "===b.charAt(0);)b=b.substring(1,b.length);if(0===b.indexOf(a))return b.substring(a.length,b.length)}return null},a.prototype.remove=function(a){return this.set(a,"",-1)},a}(),b=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b,c){return this.m.Request("customer/"+a+"/address/"+b,"GET",null,c)},a.prototype.Find=function(a,b,c){return this.m.Request("customer/"+a+"/address","GET",b,c)},a.prototype.List=function(a,b,c){return this.m.Request("customer/"+a+"/addresses","GET",b,c)},a.prototype.Create=function(a,b,c){return this.m.Request("customer/"+a+"/address","POST",b,c)},a.prototype.Fields=function(a,b,c){var d;return null==a&&(a=0),null==b&&(b=0),d=a>0&&0>=b?"customer/"+a+"/address/fields":a>0&&b>0?"customer/"+a+"/address/"+b+"/fields":"address/fields",this.m.Request(d,"GET",null,c)},a}(),c=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b){return this.m.Request("brand/"+a,"GET",null,b)},a.prototype.Find=function(a,b){return this.m.Request("brand","GET",a,b)},a.prototype.List=function(a,b){return this.m.Request("brands","GET",a,b)},a.prototype.Fields=function(a,b){var c;return null==a&&(a=0),c="brand/"+(0!==a?a+"/fields":"fields"),this.m.Request(c,"GET",null,b)},a}(),d=function(){function a(a){this.m=a,this.identifier=this.GetIdentifier()}return a.prototype.CreateIdentifier=function(){return"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[x]/g,function(){return(16*Math.random()|0).toString(16)})},a.prototype.GetIdentifier=function(){var a;return null!==this.m.Storage.get("_mb")?this.m.Storage.get("_mb"):(a=this.CreateIdentifier(),this.m.Storage.set("_mb",a),a)},a.prototype.Contents=function(a){return this.m.Request("cart/"+this.identifier,"GET",null,a)},a.prototype.Insert=function(a,b,c,d){return null==b&&(b=1),null==c&&(c=null),this.m.Request("cart/"+this.identifier,"POST",{id:a,quantity:b,modifier:c},d)},a.prototype.Update=function(a,b,c){return this.m.Request("cart/"+this.identifier+"/item/"+a,"PUT",b,c)},a.prototype.Delete=function(a){return this.m.Request("cart/"+this.identifier,"DELETE",null,a)},a.prototype.Remove=function(a,b){return this.m.Request("cart/"+this.identifier+"/item/"+a,"DELETE",null,b)},a.prototype.Item=function(a,b){return this.m.Request("cart/"+this.identifier+"/item/"+a,"GET",null,b)},a.prototype.InCart=function(a,b){return this.m.Request("cart/"+this.identifier+"/has/"+a,"GET",null,b)},a.prototype.Checkout=function(a){return this.m.Request("cart/"+this.identifier+"/checkout","GET",null,a)},a.prototype.Order=function(a,b){return this.m.Request("cart/"+this.identifier+"/checkout","POST",a,b)},a}(),e=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b){return this.m.Request("category/"+a,"GET",null,b)},a.prototype.Find=function(a,b){return this.m.Request("category","GET",a,b)},a.prototype.List=function(a,b){return this.m.Request("categories","GET",a,b)},a.prototype.Tree=function(a,b){return this.m.Request("categories/tree","GET",a,b)},a.prototype.Fields=function(a,b){var c;return null==a&&(a=0),c="category/"+(0!==a?a+"/fields":"fields"),this.m.Request(c,"GET",null,b)},a}(),f=function(){function a(a){this.m=a}return a.prototype.Payment=function(a,b,c,d){return this.m.Request("checkout/payment/"+a+"/"+b,"POST",c,d)},a}(),g=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b){return this.m.Request("collection/"+a,"GET",null,b)},a.prototype.Find=function(a,b){return this.m.Request("collection","GET",a,b)},a.prototype.List=function(a,b){return this.m.Request("collections","GET",a,b)},a.prototype.Fields=function(a,b){var c;return null==a&&(a=0),c="collection/"+(0!==a?a+"/fields":"fields"),this.m.Request(c,"GET",null,b)},a}(),h=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b){return this.m.Request("currency/"+a,"GET",null,b)},a.prototype.Set=function(a,b){return this.m.Storage.set("_mc",a),this.m.options.currency=a,"function"==typeof b?b(a):void 0},a.prototype.Find=function(a,b){return this.m.Request("currency","GET",a,b)},a.prototype.List=function(a,b){return this.m.Request("currencies","GET",a,b)},a.prototype.Fields=function(a,b){var c;return null==a&&(a=0),c="currency/"+(0!==a?a+"/fields":"fields"),this.m.Request(c,"GET",null,b)},a}(),i=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b){return this.m.Request("customer/"+a,"GET",null,b)},a.prototype.Find=function(a,b){return this.m.Request("customer","GET",a,b)},a.prototype.List=function(a,b){return this.m.Request("customers","GET",a,b)},a.prototype.Fields=function(a,b){var c;return null==a&&(a=0),c="customer/"+(0!==a?a+"/fields":"fields"),this.m.Request(c,"GET",null,b)},a}(),j=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b,c){return this.m.Request("flow/"+a+"/entry/"+b,"GET",null,c)},a.prototype.Find=function(a,b,c){return this.m.Request("flow/"+a+"/entry","GET",b,c)},a.prototype.List=function(a,b,c){return this.m.Request("flow/"+a+"/entries","GET",b,c)},a}(),k=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b){return this.m.Request("gateway/"+a,"GET",null,b)},a.prototype.List=function(a,b){return this.m.Request("gateways","GET",a,b)},a}(),l=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b){return this.m.Request("order/"+a,"GET",null,b)},a.prototype.Find=function(a,b){return this.m.Request("order","GET",a,b)},a.prototype.List=function(a,b){return this.m.Request("orders","GET",a,b)},a.prototype.Create=function(a,b){return this.m.Request("order","POST",a,b)},a}(),m=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b){return this.m.Request("product/"+a,"GET",null,b)},a.prototype.Find=function(a,b){return this.m.Request("product","GET",a,b)},a.prototype.List=function(a,b){return this.m.Request("products","GET",a,b)},a.prototype.Search=function(a,b){return this.m.Request("products/search","GET",a,b)},a.prototype.Fields=function(a,b){var c;return null==a&&(a=0),c="product/"+(0!==a?a+"/fields":"fields"),this.m.Request(c,"GET",null,b)},a.prototype.Modifiers=function(a,b){return this.m.Request("product/"+a+"/modifiers","GET",null,b)},a.prototype.Variations=function(a){return this.m.Request("product/"+a+"/variations","GET",null,callback)},a}(),n=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b){return this.m.Request("shipping/"+a,"GET",null,b)},a.prototype.List=function(a,b){return this.m.Request("shipping","GET",a,b)},a}(),p=function(){function a(a){this.m=a}return a.prototype.Get=function(a,b){return this.m.Request("tax/"+a,"GET",null,b)},a.prototype.Find=function(a,b){return this.m.Request("tax","GET",a,b)},a.prototype.List=function(a,b){return this.m.Request("taxes","GET",a,b)},a.prototype.Fields=function(a,b){var c;return null==a&&(a=0),c="tax/"+(0!==a?a+"/fields":"fields"),this.m.Request(c,"GET",null,b)},a}(),a}();
